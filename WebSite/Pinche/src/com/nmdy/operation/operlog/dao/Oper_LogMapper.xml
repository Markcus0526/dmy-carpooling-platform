<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nmdy.operation.operlog.dao.Oper_LogMapper" >

    <resultMap
        id="OperLogResult"
        type="Oper_Log" >

        <result
            column="id"
            property="id" />

        <result
            column="operuser_id"
            property="operuserid" />

        <result
            column="username"
            property="username" />

        <result
            column="oper_time"
            property="opertime" />

        <result
            column="desc"
            property="desc" />

        <result
            column="deleted"
            property="deleted" />
    </resultMap>

    <select
        id="findLogByCondition"
        parameterType="java.util.Map"
        resultMap="OperLogResult" >
            select log.id,log.operuser_id,log.oper_time ,log.desc,a.username 
            from oper_log log , administrator a where log.deleted=0 and log.operuser_id=a.id

        <if test="username != null and &apos;&apos;!= username" >
              and a.username = #{username}  
        </if>

        <if test="begin!=null and &apos;&apos;!=begin" >
        	and log.oper_time>#{begin}
        </if>

        <if test="end!=null and &apos;&apos;!=end" >
        	and #{end}>log.oper_time
        </if>

        <if test="keyword !=null and &apos;&apos;!=keyword" >
            and log.desc like '%${keyword}%'
        </if>
         LIMIT #{start},#{limit};
    </select>

    <select
        id="getCount"
        parameterType="java.util.Map"
        resultType="int" >
	    select count(*) from oper_log log , administrator a where log.deleted=0 and log.operuser_id=a.id

        <if test="userName != null and &apos;&apos; != userName" >
              AND a.userName = #{userName}  
        </if>

        <if test="begin!=null and &apos;&apos; !=begin" >
        	and log.oper_time>#{begin}
        </if>

        <if test="end!=null and &apos;&apos; !=end" >
        	and #{end}>log.oper_time
        </if>

        <if test="keyword!=null and &apos;&apos;!=keyword" >
   			 and log.desc like '%${keyword}%'
        </if>
    </select>

</mapper>