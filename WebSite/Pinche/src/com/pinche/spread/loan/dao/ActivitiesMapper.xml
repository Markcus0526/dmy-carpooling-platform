<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pinche.spread.loan.dao.ActivitiesMapper" >

    <resultMap
        id="ActivitiesResult"
        type="Activities" >

        <id
            column="id"
            property="id" />

        <result
            column="active_code"
            property="activeCode" />

        <result
            column="limit_count"
            property="limitCount" />

        <result
            column="syscoupon_id"
            property="syscouponId" />

        <result
            column="at_date"
            property="atDate" />

        <result
            column="isenabled"
            property="isenabled" />

        <result
            column="deleted"
            property="deleted" />

        <result
            column="syscoupon_code"
            property="syscouponCode" />

        <result
            column="sum"
            property="point" />

        <result
            column="deploy_count"
            property="deployCount" />

        <result
            column="coupon_type"
            property="couponType" />

        <result
            column="limit_val"
            property="limit_val" />

        <result
            column="valid_period_unit"
            property="valid_period_unit" />

        <result
            column="valid_period"
            property="valid_period" />
    </resultMap>

    <select
        id="search"
        parameterType="hashmap"
        resultMap="ActivitiesResult" >
		SELECT A.*, SC.syscoupon_code, SC.sum, SC.coupon_type, SC.limit_val, SC.valid_period_unit, SC.valid_period 
		FROM activities AS A
		LEFT JOIN sys_coupon AS SC
		ON A.syscoupon_id=SC.id
		WHERE 1

        <if test="activityCode != &apos;&apos;" >
			AND A.active_code LIKE #{activityCode}
        </if>

        <if test="price != 0" >
			AND SC.sum = #{price}
        </if>
		AND A.deleted=0 ORDER BY id

        <if test="searchall == 0" >
			LIMIT #{page}, #{rows}
        </if>
    </select>

    <insert
        id="insert"
        keyProperty="id"
        parameterType="Activities"
        useGeneratedKeys="true" >
		INSERT INTO
		activities(active_code, limit_count, syscoupon_id, at_date, isenabled, 
		deleted)
		VALUES(#{activeCode}, #{limitCount}, #{syscouponId}, #{atDate}, #{isenabled}, 
		#{deleted})
    </insert>

    <select
        id="findOneByCode"
        parameterType="string"
        resultMap="ActivitiesResult" >
		SELECT * FROM activities 
		WHERE active_code=#{activityCode} AND deleted=0 ORDER BY id
    </select>

    <update
        id="update"
        parameterType="Activities" >
		UPDATE activities 
		SET active_code=#{activeCode}, limit_count=#{limitCount}, syscoupon_id=#{syscouponId}, at_date=#{atDate}, isenabled=#{isenabled}, 
		deleted=#{deleted}
		WHERE id=#{id}
    </update>

</mapper>